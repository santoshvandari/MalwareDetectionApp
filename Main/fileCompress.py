import lzma
import shutil
import os
from core.settings import MEDIA_ROOT

def CompressFile(filename):
    if not filename:
        return False

    filepath = os.path.join(MEDIA_ROOT, 'UploadFiles', filename)
    if not os.path.exists(filepath):
        return False

    # Define the path for the compressed file
    compressed_dir = os.path.join(MEDIA_ROOT, 'CompressedFiles')
    
    # Ensure the directory exists
    if not os.path.exists(compressed_dir):
        os.makedirs(compressed_dir)

    compressed_filepath = os.path.join(compressed_dir, f"{filename}.xz")

    try:
        # Compress the file using lzma with maximum compression level
        with open(filepath, 'rb') as f_in:
            with lzma.open(compressed_filepath, 'wb', preset=9 | lzma.PRESET_EXTREME) as f_out:
                shutil.copyfileobj(f_in, f_out)

        return f"{filename}.xz"
    
    except Exception as e:
        print(f"An error occurred while compressing the file: {e}")
        return False
