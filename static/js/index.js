document.addEventListener('DOMContentLoaded', () => {
    // Handle form submission
    document.getElementById('uploadForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission
        

        let formData = new FormData(this);
        const fileInput = document.getElementById('fileInput');
        // Check if a file is selected
        if (!fileInput.files.length) {
            alert("Please Select a File to Upload");
            return;
        }
    
        const loadingOverlay = document.getElementById('loading-overlay');

        // Show loading overlay
        loadingOverlay.style.display = 'flex';

        fetch('/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken') // Include CSRF token
            }
        })
        .then(response => response.json())
        .then(data => {
        loadingOverlay.style.display = 'none';

            if (data.malware) {
                // Play warning sound
                const warningSound = document.getElementById('warning-sound');
                warningSound.play();

                // Show custom dialog box
                showAlert('Malware Detected', data.message);
            } else if(data.fileName){
                // Handle file compression success
                // alert(data.message);
                location.href = '/compress?filename=' + data.fileName;
            }else{
                // Handle file compression failure
                alert("* Something Went Wrong!! Please Try Again");
            }
        })
        .catch(error => console.error('Error:', error));
    });

    function showAlert(title, message) {
        const dialog = document.getElementById('dialog');
        const dialogMessage = document.getElementById('dialog-message');
        const cancelButton = document.querySelector('#dialog .cancel');
        
        dialogMessage.textContent = message;
        dialog.style.display = 'flex';

        cancelButton.addEventListener('click', () => {
            dialog.style.display = 'none';
        });
    }

    // Handle file input change
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('file-info');

    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileInfo.textContent = `Selected file: ${fileInput.files[0].name}`;
        } else {
            fileInfo.textContent = 'No file selected';
        }
    });
});
