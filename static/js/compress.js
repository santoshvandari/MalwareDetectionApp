document.addEventListener('DOMContentLoaded', () => {

    // Handle form submission
    document.getElementById('uploadForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission
        var formData = new FormData(this);
        const loadingOverlay = document.getElementById('loading-overlay');

        // Show loading overlay
        loadingOverlay.style.display = 'flex';

        fetch('/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': getCookie('csrftoken') // Include CSRF token
            }
        })
        .then(response => response.json())
        .then(data => {
        loadingOverlay.style.display = 'none';

            if (data.malware) {
                // Play warning sound
                const warningSound = document.getElementById('warning-sound');
                warningSound.play();

                // Show custom dialog box
                showAlert('Malware Detected', data.message);
            } else if(data.fileName){
                // Handle file compression success
                // alert(data.message);
                location.href = '/compress?filename=' + data.fileName;
            }else{
                // Handle file compression failure
                alert("* Something Went Wrong!! Please Try Again");
            }
        })
        .catch(error => console.error('Error:', error));
    });

    
});
